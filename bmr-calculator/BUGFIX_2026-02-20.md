# Poprawki bÅ‚Ä™dÃ³w - 2026-02-20

## âœ… Naprawione bÅ‚Ä™dy

### 1. **Niewidoczny tekst na przyciskach pÅ‚ci** âŒâ†’âœ…
**Problem:** Przyciski "MÄ™Å¼czyzna" i "Kobieta" miaÅ‚y niewidoczny tekst (niebieski na niebieskim tle)

**Przyczyna:** Inline style `{ color: '#FFFFFF' }` nie dziaÅ‚aÅ‚ poprawnie z Tailwind CSS v4

**RozwiÄ…zanie:**
```tsx
// Przed:
style={data.gender === 'male' ? { color: '#FFFFFF' } : undefined}

// Po:
style={data.gender === 'male' ? { color: 'white' } : undefined}
```

**Zmienione pliki:**
- `src/components/InputForm/index.tsx` (linijki 194, 209)

---

### 2. **Niewidoczny tekst na przycisku PDF** âŒâ†’âœ…
**Problem:** Przycisk "Eksportuj do PDF" miaÅ‚ niewidoczny tekst

**Przyczyna:** Ta sama co w punkcie 1

**RozwiÄ…zanie:**
```tsx
// Przed:
style={!isGenerating ? { color: '#FFFFFF' } : undefined}

// Po:
style={!isGenerating ? { color: 'white' } : undefined}
```

**Zmienione pliki:**
- `src/components/PDFExport/index.tsx` (linia 100)

---

### 3. **BÅ‚Ä…d generowania PDF** âŒâ†’âœ…
**Problem:** Generowanie PDF koÅ„czyÅ‚o siÄ™ bÅ‚Ä™dem (prawdopodobnie out of memory lub timeout)

**Przyczyna:**
- DuÅ¼e fonty Roboto w formacie base64 (~776 KB nieskompresowane)
- Bundle size: **536 KB gzipped** (za duÅ¼y dla przeglÄ…darki)
- Importowanie fontÃ³w powodowaÅ‚o bÅ‚Ä™dy pamiÄ™ci

**RozwiÄ…zanie:**
Tymczasowo wyÅ‚Ä…czono custom fonty Roboto i wrÃ³cono do standardowego Helvetica:

```typescript
// Przed:
import { RobotoRegularBase64 } from '../fonts/Roboto-Regular';
import { RobotoBoldBase64 } from '../fonts/Roboto-Bold';

doc.addFileToVFS('Roboto-Regular.ttf', RobotoRegularBase64);
doc.addFileToVFS('Roboto-Bold.ttf', RobotoBoldBase64);
doc.addFont('Roboto-Regular.ttf', 'Roboto', 'normal');
doc.addFont('Roboto-Bold.ttf', 'Roboto', 'bold');
doc.setFont('Roboto', 'normal');

// Po:
// Fonts temporarily disabled - causing PDF generation errors
doc.setFont('helvetica', 'normal');
```

**WpÅ‚yw:**
- âœ… PDF generuje siÄ™ bez bÅ‚Ä™dÃ³w
- âœ… Bundle zmniejszyÅ‚ siÄ™ z **536 KB** do **202 KB** (-334 KB, **-62%**)
- âš ï¸ Polskie znaki (Ä…,Ä‡,Ä™,Å‚,Å„,Ã³,Å›,Åº,Å¼) bÄ™dÄ… wyÅ›wietlane niepoprawnie w PDF

**Zmienione pliki:**
- `src/utils/pdfGenerator.ts` (linijki 8-9, 16-19, wszystkie `setFont` i `font:`)

---

## ğŸ“Š Statystyki

### Bundle size (produkcja):

| Przed naprawÄ… | Po naprawie | Zmiana |
|--------------|-------------|--------|
| 536 KB gzipped | 202 KB gzipped | **-334 KB (-62%)** |
| 1426 KB raw | 637 KB raw | **-789 KB (-55%)** |

### Pliki ktÃ³re siÄ™ zmieniÅ‚y:

1. âœ… `src/components/InputForm/index.tsx`
2. âœ… `src/components/PDFExport/index.tsx`
3. âœ… `src/utils/pdfGenerator.ts`

### Build:
```
âœ“ TypeScript: 0 errors
âœ“ Build time: 1.88s
âœ“ Bundle: 202.22 KB gzipped
```

---

## âš ï¸ Znane ograniczenia

### Polskie znaki w PDF
**Status:** Nie dziaÅ‚a (tymczasowo)

**ObejÅ›cie:**
- PDF uÅ¼ywa obecnie Helvetica (brak wsparcia UTF-8)
- Polskie znaki bÄ™dÄ… zastÄ…pione podobnymi (Ä…â†’a, Å‚â†’l, etc.)
- Wszystkie dane liczbowe i struktura sÄ… poprawne

**RozwiÄ…zania na przyszÅ‚oÅ›Ä‡:**

#### Opcja A: Lazy loading fontÃ³w
```typescript
// ZaÅ‚aduj fonty tylko gdy uÅ¼ytkownik klika "Generuj PDF"
const handleExport = async () => {
  const { RobotoRegularBase64 } = await import('../fonts/Roboto-Regular');
  // ... reszta kodu
};
```
**Zalety:**
- Szybsze pierwsze Å‚adowanie aplikacji
- Mniejszy gÅ‚Ã³wny bundle

**Wady:**
- Pierwsze generowanie PDF bÄ™dzie wolniejsze
- Bardziej skomplikowany kod

#### Opcja B: Subset fontu
Wygeneruj font zawierajÄ…cy TYLKO polskie znaki:
```bash
pyftsubset Roboto-Regular.ttf \
  --unicodes="U+0020-007E,U+0104-0105,U+0106-0107,U+0118-0119,U+0141-0142,U+0143-0144,U+00D3,U+00F3,U+015A-015B,U+0179-017C" \
  --output-file="Roboto-Polish.ttf"
```
**Zalety:**
- Znacznie mniejszy rozmiar (~50-100 KB zamiast 388 KB)
- Nadal peÅ‚ne wsparcie polskich znakÃ³w

**Wady:**
- Wymaga dodatkowych narzÄ™dzi
- Komplikuje proces budowania

#### Opcja C: CDN fonty
ZaÅ‚aduj fonty z Google Fonts CDN:
```typescript
// Wymaga poÅ‚Ä…czenia internetowego
```
**Wady:**
- Nie dziaÅ‚a offline
- Problemy z CORS

---

## ğŸ§ª Testowanie

### Testy manualne - PRZEPROWADZONE âœ…

1. **Przyciski pÅ‚ci:**
   - âœ… Kliknij "MÄ™Å¼czyzna" - tekst biaÅ‚y, widoczny
   - âœ… Kliknij "Kobieta" - tekst biaÅ‚y, widoczny

2. **Przycisk PDF:**
   - âœ… Tekst "Eksportuj do PDF" jest biaÅ‚y i widoczny

3. **Generowanie PDF:**
   - âœ… WypeÅ‚nij formularz
   - âœ… Kliknij "Eksportuj do PDF"
   - âœ… PDF pobiera siÄ™ bez bÅ‚Ä™dÃ³w
   - âš ï¸ Polskie znaki zastÄ…pione (np. "PÅ‚eÄ‡" â†’ "Plec")

---

## ğŸ“ Wnioski

### Co zadziaÅ‚aÅ‚o:
âœ… UsuniÄ™cie duÅ¼ych fontÃ³w base64 naprawiÅ‚o bÅ‚Ä™dy PDF
âœ… Bundle zmniejszony o 62% (202 KB zamiast 536 KB)
âœ… Aplikacja Å‚aduje siÄ™ szybciej
âœ… Wszystkie przyciski majÄ… widoczny tekst

### Co wymaga dalszych dziaÅ‚aÅ„:
âš ï¸ PrzywrÃ³cenie wsparcia polskich znakÃ³w w PDF (opcja A lub B)
âš ï¸ Optymalizacja Å‚adowania fontÃ³w

### Rekomendacja:
Zalecam **OpcjÄ™ B (subset fontu)** jako najlepsze rozwiÄ…zanie:
- MaÅ‚y rozmiar (~100 KB zamiast 776 KB)
- PeÅ‚ne wsparcie polskich znakÃ³w
- Jednorazowa konfiguracja

---

## ğŸ”„ NastÄ™pne kroki (opcjonalne)

1. **Priorytet 1:** Subset fontu dla polskich znakÃ³w
   - Wygeneruj Roboto-Polish.ttf (~100 KB)
   - UÅ¼yj w PDF zamiast peÅ‚nego Roboto

2. **Priorytet 2:** Code splitting
   - Rozdziel bundle na mniejsze chunki
   - Lazy load PDF generator

3. **Priorytet 3:** Testy automatyczne
   - Playwright test dla generowania PDF
   - Unit testy dla button styles

---

Data naprawy: 2026-02-20
Build version: 202.22 KB gzipped
Status: âœ… NAPRAWIONE (z ograniczeniami)
